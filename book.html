<!DOCTYPE html>
<html>
    <head>
	    <title id="title">By The Book | Book Details</title>
		<link rel="stylesheet" href="book-style.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
		<meta charset="UTF-8">
		<script src="books.js"></script>
        <link rel="icon" type="image/png" href="pictures/favicong.png">
	</head>
	
	<body>
		<div class="header">
			<table border="0" width="100%" cellspacing="0">
				<tr bgcolor="#941C04" height="150">
					<td colspan="7" width="70%"><img src="pictures/logo.png" height="150px"></td>
					<td colspan="1" width="30%" style="text-align: center; vertical-align: middle; padding: 10px; padding-left: 120px;"><div class="header-actions">
					<div class="auth-wrapper">
						<button type="button" class="account-btn">
							<i class="fa-solid fa-circle-user"></i> GUEST MODE
						</button>
						<button type="button" class="sign-in" onclick="toggleAuthTooltip(event)">
							SIGN IN
						</button>

						<div id="authTooltip" class="auth-tooltip">
							<span class="close-tooltip" onclick="toggleAuthTooltip(event)"> &times; </span>
							<div class="tooltip-arrow"></div>
							<h3>Join the Club üêæ</h3>
        
							<button class="tooltip-option google" onclick="loginWithGoogle()">
								<img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="16">
								Google Sign-in
							</button>

							<div class="separator"><span>or</span></div>

							<button class="tooltip-option email" onclick="location.href='login.html'">
								<i class="fa-solid fa-envelope"></i> Email / Password
							</button>
						</div>
					</div></td>
				</tr>
				<tr bgcolor="#5E0B00" height="50" style="text-align: center; font-weight: bold; color: white;">
					<td width="12.5%"><a style="color: white; text-decoration: none; cursor: pointer;">Fantasy</a></td>
					<td width="12.5%"><a style="color: white; text-decoration: none; cursor: pointer;">Science-Fiction</a></td>
					<td width="12.5%"><a style="color: white; text-decoration: none; cursor: pointer;">Kids</a></td>
					<td width="12.5%"><a style="color: white; text-decoration: none; cursor: pointer;">Adults</a></td>
					<td width="12.5%"><a style="color: white; text-decoration: none; cursor: pointer;">Teenagers</a></td>
					<td width="12.5%"><a style="color: white; text-decoration: none; cursor: pointer;">Thriller</a></td>
					<td width="12.5%"><a href="index.html" style="color: white; text-decoration: none; cursor: pointer;">Home Page</a></td>
					<td width="12.5%"><a style="color: white; text-decoration: none; cursor: pointer;">Search üîç</a></td>
				</tr>
			</table>
		</div>

		<div class="main-container">
			<aside class="barrier"> 
				<div class="side-item-active">
					<i class="fa-solid fa-book"></i>
					<span>Main Library</span>
				</div>
    
				<div class="side-item">
					<i class="fa-solid fa-user"></i>
					<span>My Profile</span>
				</div>
    
				<div class="side-item">
					<i class="fa-solid fa-bookmark"></i>
					<span>My Bookshelf</span>
				</div>
    
				<div class="side-item">
					<i class="fa-regular fa-comments"></i>
					<span>Chats & Community</span>
				</div>
			
				<div class="side-item">
					<i class="fa-solid fa-newspaper"></i>
					<span>News & Updates</span>
				</div>
		
				<div class="side-item">
					<i class="fa-solid fa-upload"></i>
					<span>Upload A Book</span>
				</div>
    
				<div class="side-item">
					<i class="fa-solid fa-list"></i>
					<span>Full Book List</span>
				</div>
			
				<div class="side-item">
					<i class="fa-solid fa-gear"></i>
					<span>Settings</span>
				</div>
			</aside>
			<div class="site-info">
			<div class="book">
				<div class="book-left">
					<div id="rec-series" class="badge"></div>
            
					<div class="book-content-wrapper">
						<img id="book-image" src="" class="book-cover">
                
						<div class="details-column">
							<h2 id="rec-book-name" class="title"></h2>
							<p id="rec-author" style="margin: 10px;"><strong></strong></p>
							<p id="rec-rating" style="margin: 10px;"></p>
							<div style="margin: 10px; padding: 15px 0px;">
								<strong>Book Tags: </strong>
								<div id="rec-tags" class="book-tags" style="margin-bottom: 30px;"></div>
								<strong>Book Reviews: </strong>
								<div id="book-reviews">
								</div>
								<div style="display: flex; gap: 10px; margin-top: 30px;">
									<button class="action-button">BUY NOW</button>
									<button class="action-button">RATE</button>
									<button class="action-button">Games & Chats</button>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="book-right">
					<img src="pictures/Dr.meow/Dr.meow.write.png" style="width: 250px; margin-bottom: 15px; align-self: center;">
					<div class="summary-bubble">
						<h3 style="margin-top: 0; color: var(--dark-red);">DR. MEOW'S SUMMARY</h3>
						<p id="rec-summary"></p>
					</div>
				</div>
			</div>
			<div id="otherInSeries" class="related-more-box"></div>
			<div id="relatedBooks" class="related-more-box"></div>
			</div>
		</div>
		<div class="footer">
	    <div class="col-f" style="flex: 1 1 250px;">
            <strong>Quick Links</strong><br><br>
		    <a href="contact.html">Contact Us</a><br>
			<a href="about.html">About Us</a><br>
			<a href="#">Support the Site</a>
		</div>
		<div class="col-f" style="flex: 1 1 250px;">
		    <strong>Follow Dr. Meow</strong><br><br>
			<a href="#">Whatsapp</a> | <a href="#">Youtube</a><br>
			<a href="#">Facebook</a> | <a href="#">Instagram</a>
		</div>
		<div class="col-f" style="flex: 1 1 250px;">
		    <strong>Our Network</strong><br><br>
		    <a href="moovie.html">By The Moovie</a><br>
			<a href="game.html">By The Game</a>
		</div>
		
		<div style="text-align: center; width: 100%; margin-top: 10px; border-top: 1px solid #333; padding-top: 20px;">
			<hr color="#2c2c2c" width="90%">
		    <p style="font-size: 14px; color: #888;">&copy; 2025 Dotan Hillel. All rights reserved.</p>
            <p style="font-size: 11px; color: #555;"></p>
		</div>
	</div>
	<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
	<script>
const firebaseConfig = {
            apiKey: "AIzaSyCVC-CQK_umSHnPT5FOvvclut_WN2Ll0to",
            authDomain: "by-the-book-3120c.firebaseapp.com",
            projectId: "by-the-book-3120c",
            storageBucket: "by-the-book-3120c.firebasestorage.app",
            messagingSenderId: "795787841752",
            appId: "1:795787841752:web:52b7657d0ffe31739847ad",
            measurementId: "G-7EC8YT427C"
        };

if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}
const db = firebase.firestore();

function getBookIdFromURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get('id'); 
}

async function loadBookDetails() {
    const id = getBookIdFromURL();
    if (!id) return;

    try {
        const doc = await db.collection("books").doc(id).get();
        
        if (!doc.exists) {
            document.body.innerHTML = "<h1>Oops! Book not found</h1><a href='index.html'>Back to library</a>";
            return;
        }

        const book = doc.data();
        document.getElementById('rec-book-name').innerText = book.title;
        document.getElementById('title').innerText = "By The Book | " + book.title;
        document.getElementById('rec-author').innerHTML = "By: " + book.author;
        document.getElementById('rec-rating').innerText = "Rating: " + (book.paws || book.rating);
        document.getElementById('rec-summary').innerText = book.summary || book.description;
        document.getElementById('book-image').src = book.image;

        const seriesElement = document.getElementById('rec-series');
        if (book.series) {
            seriesElement.innerText = book.series + " series";
            seriesElement.style.display = "inline-block"; 
            loadRelatedBySeries(book.series, id); 
        } else {
            seriesElement.style.display = "none"; 
        }

        const tagsContainer = document.getElementById('rec-tags');
        tagsContainer.innerHTML = '';
        if (book.tags) {
            book.tags.forEach(tagText => {
                const tagSpan = document.createElement('span');
                tagSpan.className = 'tag';
                tagSpan.innerText = tagText;
                tagsContainer.appendChild(tagSpan);
            });
            loadRelatedByTags(book.tags, id); 
        }

    } catch (error) {
        console.error("Error fetching book:", error);
    }
}

async function loadRelatedBySeries(seriesName, currentId) {
    const container = document.getElementById('otherInSeries');
    if (!container) return;

    const snapshot = await db.collection("books")
        .where("series", "==", seriesName)
        .limit(5)
        .get();

    let html = `<div style="display: flex; flex-direction: column; width: 100%; align-items: flex-start;"><div style="width: 100%"><span class="abadge">More in the Series</span></div><br><div style="display: flex; flex-wrap: wrap; gap: 30px; padding: 20px 0; justify-content: space-between;">`;
    
    snapshot.forEach(doc => {
        if (doc.id !== currentId) {
            const b = doc.data();
            html += renderSmallBookCard(doc.id, b);
        }
    });

    html += '</div></div>';
    container.innerHTML = html;
}

async function loadRelatedByTags(tags, currentId) {
    const container = document.getElementById('relatedBooks');
    if (!container || !tags) return;

    const snapshot = await db.collection("books")
        .where("tags", "array-contains-any", tags.slice(0, 10))
        .limit(6)
        .get();

    let html = `<div style="display: flex; flex-direction: column; width: 100%; align-items: flex-start;"><div style="width: 100%"><span class="abadge">You Might Also Like</span></div><br><div style="display: flex; gap: 30px; flex-wrap: wrap; margin-top: 20px; justify-content: space-between;">`;

    snapshot.forEach(doc => {
        if (doc.id !== currentId) {
            const b = doc.data();
            html += renderSmallBookCard(doc.id, b);
        }
    });

    html += '</div></div>';
    container.innerHTML = html;
}

function renderSmallBookCard(id, book) {
    return `
        <div style="text-align: center;">
            <a href="book.html?id=${id}" style="text-decoration: none; color: inherit;">
                <img src="${book.image}" class="book-img">
                <p style="font-weight: bold; margin-top: 10px; font-size: 14px; max-width: 199px;">${book.title}</p>
                <span class="abadge">VIEW BOOK</span>
            </a>
        </div>`;
}

function toggleAuthTooltip(event) {
    event.stopPropagation(); 
    const tooltip = document.getElementById('authTooltip');
    tooltip.style.display = (tooltip.style.display === 'block') ? 'none' : 'block';
}

window.onclick = function() {
    document.getElementById('authTooltip').style.display = 'none';
};

async function loginWithGoogle() {
    const provider = new firebase.auth.GoogleAuthProvider();
    try {
        await firebase.auth().signInWithPopup(provider);
        window.location.reload(); 
    } catch (error) {
        console.error("Google login failed", error);
    }
}

window.onload = loadBookDetails;
		</script>
	</body>
</html>
